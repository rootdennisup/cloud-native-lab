#  故障排除指南

## 一、通识篇
 
### Q1：使用 Tailscale 一劳永逸的连接阿里云 ECS 服务器？

#### 需求背景

- 云原生学习过程中，我采用 ECS 云服务器节约时间成本，因为 ECS 需要设置防火墙安全组规则，避免挖矿告警；
- 开放安全组规则 SSH 远程连接，这里配置的是本机对应运营商的公网IP，因为这个公网IP是动态的，意味着我本机通过 SSH 工具连接 ECS 时，需要经常重新配置安全组的IP；
- 另一方面，我希望在公司、家里台式机、以及笔记本在旅行过程中也能够连接 ECS；
- 基于上述几点，我希望有一个免费的、一劳永逸的方案连接 ECS 云服务器，例如： **使用 Zero Trust 网络（如 Tailscale）**。


#### Zero Trust 网络原理

- 传统网络模型是“信任内网、警惕外网”，就像一座城堡，进了城门就相对安全；我的问题在此模型下，需要不断地告诉安全组（守卫）哪个IP是可靠的（好人）。
- **零信任的原则是：从不信任，永远验证**

    - **身份即边界**：网络边界由身份（你的设备、账户）来定义，而不是由传统的IP；Tailscale 为每个设备分配一个唯一、加密的“身份证书”。
    - **加密隧道**：当我的设备（台式机、笔记本、ECS）都安装了 Tailscale 客户端，并登录同一个账号后，会通过互联建立一个点对点、端到端加密的虚拟专用通道；这个通道独立于我的物理网络。
    - **协调服务器**：Tailscale 提供了协调服务器，作用类似于“电话总机”。设备上线时，会向协调器报道，告诉协调器自己的加密公钥和当前 IP。当电脑连接 ECS 时，协调器会直接建立连接，而数据流并不经过 Tailscale 服务器，保证性能和隐私。

#### 操作步骤

- 第1步：注册账号

    - 进入 Tailscale 官网（https://login.tailscale.com/admin/welcome），建议用 Google 邮箱注册；
    - 注册成功后，选择完几个选项即可进入管理控制台，如下图：
    
        ![](F1-01)![](.\images\F1-01.png)

- 第2步：ECS 上安装并登录 Tailscale

    - 通过 SSH 登录 ECS 服务器
    - ubuntu 系统安装 Tailscale 客户端
        ```bash
        # 添加Tailscale的APT源
        curl -fsSL https://tailscale.com/install.sh | sh
        # 启动Tailscale服务并登录认证
        sudo tailscale up
        ```
        _*注：若安装失败，可删除冗余文件重新安装，也可将报错日志贴给DeepSeek，根据提示方案去解决。_
    - 执行```sudo tailscale up ```后，命令行会弹出一个认证连接，在本地电脑流量器打开这个链接，然后点击【Connect】接受认证
    - 在 ECS 中执行 ```tailscale ip```命令，会显示形如： 100.x.x.x的 IP 地址，这是 ECS 在虚拟局域网中的专属 IP

- 第3步：在本地电脑安装并登录 Tailscale
 
    - 从 Tailscale 官网下载安装包，和安装普通软件一样进行安装
    - 登录，打开安装好的 Tailscale 客户端，它会自动打开浏览器让你登录，登录账号还是上文中同一个 Google 邮箱账号
    - 登录成功后，任务栏会出现Tailscale的图标（Windows环境，Mac也类似），并打了对勾表示登录成功 

    _本地电脑：家用电脑、公司电脑、笔记本操作思路一样。_
    
- 第4步：验证

    - 可在 tailscale 控制台查看管理的机器

        ![](F1-02)![](.\images\F1-02.png)
    - 本地电脑使用 SSH 工具连接 ECS 的 tailscale ip
        - 通过 SSH 登录 ECS，执行 ```tailscale ip```
        - 这个命令会返回一组IP（IPv4、IPv6）
        - 选 IPv4 IP 在 SSH 工具新建会话，进行连接即可

- 第5步：ECS 网络安全调整
    
    找到 SSH 规则，将源IP​ 改为 127.0.0.1/32，表示只允许服务器自己访问自己。
 


